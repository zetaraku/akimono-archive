#-----------------------------------------------------------------
# 商人物語 移転プログラム マニュアル
#-----------------------------------------------------------------

１．ごあいさつ

他の街からの移転を可能にするためのプログラムです。
店舗のデータをまるごと別の街へ移動できます。
自分のサイト内の街だけでなく，他のサイトの商人物語とも，移転交流できます。

ただし，移転を可能にするためには，設置しているサーバーにて，
socket を利用した通信が許可されている必要があります。

実際許可されているサーバーは少ないので，よく調査してください。


２．設置方法

１） まず， _config.cgi にて，移転機能を有効にします。
     28行目付近を見て，$MOVETOWN_ENABLEを 1 に設定します。

２） また，街コードが，移転交流したい他の街と重複しないか，確認してください。
     いままで設定していなかった人も，改めて設定してください。
     街コードは，_config.cgi 20行目付近の $TOWN_CODE で記述されています。

３） recv-shop.cgi を開き，一行目のperlのパスを設定します。
     そして，移転交流したい街のフォルダ（akimono，uronなど）にアップします。
     パーミッションは，755などに設定します。

             akimono <dir>
                └ recv-shop.cgi       [755]

４） ２）で指定した街コードの名前をつけて，「（街コード）.cgi」というファイルを作ります。
     たとえば，２）で街コードを「flower」に設定していたら，「flower.cgi」というファイルを作ります。

     サンプルを用意しましたので，「サンプル.cgi」をご参照ください。
     # で始まる行は注釈扱いとなり，無視されます。 
     詳しいキーは次の通りです。

     △ name 　[街の名称]       ： 街の名称です。必須。

     △ comment　[コメント]     ： 街の簡単な紹介コメントです。簡潔に。

     △ recvshopurl　[akimono/recv-shop.cgiのURL]   ：  akimono/recv-shop.cgiの場所です。

     △ url　[街へのリンクURL]  ： 街のアドレスです。
                                   index.cgiに飛ぶのが普通ですが，iswebなど直リンク禁止のところではindex.htmlなど。

     △ password　[移転元証明用パスワード]  ： 不正な移転を防ぐために内部で設定するパスワード（半角英数）です。
                                               管理パスとは同じにしないでください。
                                               覚える必要がないのでめちゃくちゃな文字列を指定しましょう。

     △ position　[街の位置]  ： 街のある座標です。それぞれ -1000 ～ +1000 程度の範囲で記述してください。 街の位置により，移転先までの距離が決まり，移動にかかる時間が計算されます。 現在のところ，座標 1 ポイントは約 400 ｍに該当します。
                                 この座標の関係で，移転にかかる時間が影響します。

     △ blockip　[同一IPアドレスの拒否]  ： すでに同じ IP アドレスからアクセスされている店舗がある場合，移転を拒否します。

     △ myaddr　[移転元証明用IPアドレス(正規表現)]  ： 自サイトの IP アドレスです。これを指定しないと移転ができないサーバーがあります。

            ※サイトの IP アドレス
                自分のコンピュータにIPアドレスがあるように，サーバーにもIPアドレスがあります。
                サーバーに問い合わせないと分からないことが多いです。

     △ group　[グループ設定]  ： 自サイトにいくつかの街を立ち上げている場合，それらをグループ化するためのグループコード(任意)を半角英数にて記述します。 同じグループ内での移転では，同一 IP アドレス&ブラウザの自動アクセス制限チェックの設定が引き継がれます。

     △ allowguild　[移転許可ギルド]  ： 移転受入を許可するギルドのコードをカンマ(,)で区切って記述します。 これを設定した場合は，許可以外のギルドは受け入れません。 (無所属は移転可能)

     △ denyguild　[移転拒否ギルド]   ： 移転受入を拒否するギルドのコードをカンマ(,)で区切って記述します。 これを設定した場合は，拒否以外のギルドのみ受け入れます。 (無所属は移転可能)

     △ onlyguild　[ギルド所属のみ移転許可]  ： ギルドに所属している場合のみ移転を許可します。 allowguild や denyjob との組み合わせで，特定ギルドのみ移転可能になります。

     △ noguild　[ギルド所属のみ移転拒否]   ： ギルドに所属している場合のみ移転を拒否します。

     △ allowmoney　[移転許可資金]   ： 移転受入を許可する資金額を記述します。 設定額より多い資金の店舗のみ受け入れます。

     △ denymoney　[移転拒否資金]    ： 移転受入を拒否する資金額を記述します。 設定額より多い資金の店舗の受け入れを拒否します。

     △ allowtopcount　[移転許可トップ獲得回数]  ： 移転受入を許可するトップ獲得回数を記述します。 設定より多いトップ獲得回数の店舗のみ受け入れます。

     △ denytopcount　[移転拒否トップ獲得回数]  ：  移転受入を拒否するトップ獲得回数を記述します。 設定より多いトップ獲得回数の店舗の受け入れを拒否します。

     △ allowfoundation　[移転許可開業期間]  ：  移転受入を許可する新装開店からの開業期間(秒)を記述します。 設定より長い開業期間の店舗のみ受け入れます。

     △ denyfoundation　[移転拒否開業期間]  ：  移転受入を拒否する新装開店からの開業期間(秒)を記述します。 設定より長い開業期間の店舗の受け入れを拒否します。

     △ allowjob　[移転許可職業]  ：  移転受入を許可する職業のコードをカンマ(,)で区切って記述します。 これを設定した場合は，許可以外の職業は受け入れません。 (無職は移転可能)

     △ denyjob　[移転拒否職業]  ：  移転受入を拒否する職業のコードをカンマ(,)で区切って記述します。 これを設定した場合は，拒否以外の職業のみ受け入れます。 (無職は移転可能)

     △ onlyjob　[職業ありのみ移転許可]  ： 職業がある場合のみ移転を許可します。 allowjob や denyjob との組み合わせで，特定職業のみ移転可能になります。

     △ nojob　[職業ありのみ移転拒否]  ：  職業がある場合のみ移転を拒否します。

     △ allowuserdata　[受け入れる$DT->{user}のキー]  ：  $DT->{user}の各項目のうち，受け入れる項目のキーをカンマ(,)区切りで記述します。
                                                          'none' とだけ設定すると，全項目の受け入れを拒否します。(allowuserdata=none)



５） 作成した「（街コード）.cgi」を，program 内 town フォルダの中にアップします。
     また，移転先の「（街コード）.cgi」も，同様に準備してアップします。

６） inc-menu.cgi を開き，メニューリストに，「引越し」を加えます。
     「施設」のリストに次の１行を加えるといいでしょう。

		['引越し',	'move'],


