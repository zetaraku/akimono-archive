#-----------------------------------------------------------------
# 商人物語 貿易センタープログラム マニュアル
#-----------------------------------------------------------------

１．ごあいさつ

貿易センターを設立し，参加サイトの貿易を処理するプログラムです。

トラブル時の解決にはかなりのスキルを要求されます。
あまり時間を費やせない方や，プログラムにまだ慣れていない方は，
手を出さないほうがいいと思います。

socket による外部通信が使えるサーバーでないと動作しません。
また，flock・alarm を利用するため，Windows 系のサーバーでは動作しないと思われます。

なお，このプログラムは，貿易センターを設立するだけですので，
それにつなげて貿易を可能にするには，参加プログラムを別途ご用意ください。


２．設置方法

１） まず， trade-system.cgi を開き，一行目のperlのパスを設定します。
     そして，サーバーにフォルダごとアップします。
     商人物語のゲーム本体とは別なところに置いて構いません（関係がないので）。
     パーミッションは，次の通りです。

              trade <dir> [755]
                ├ trade-system.cgi [755]
                ├ log.cgi          [666]
                ├ time.cgi         [666]
                ├ lockfile         [666]
                └ site <dir>       [755]

  # 設置したtrade-system.cgi のアドレスへアクセスし，
  # エラーが無ければ（何も表示されなければ）とりあえず大丈夫っぽいです。


２）  一定時間ごとにこのtrade-system.cgi へのアクセスがなければならないので，
      以下のどちらかの方法で，アクセスが起こるようにします。

   ◆IMGタグを利用する方法
   頻繁にアクセスされるページに <img src="trade-system.cgiへのアドレス?img" width="1" height="1">
   を記述する方法です。どのようなサーバーでも使用できます。
   なお，この方法を利用する場合は，URL の最後に「?img」を必ず付けてください。

   ◆SSIを利用する場合
   頻繁にアクセスされるページ（拡張子が.shtml でないといけません）に
   <!--#exec cgi="このスクリプトの位置"-->
   を記述する方法です。スクリプト名が公表されない利点があります。


３．参加サイトの登録方法

# 登録街数を多くすると貿易処理の時間がかかり問題が起こりやすくなります。
# 多くとも街数10程度が限界なので，それ以上は登録できないようになっています。

１） 参加希望サイトからの申請を受け付けます。
     このとき，(1)希望サイトの trade.cgi のアドレス，(2)街コードを確認します。

  ※街コードは，他のサイトと重複していないか確認します。


２） site フォルダの中に，新しいフォルダを作成し，フォルダ名を「街コード」にします。
     そして，そのフォルダに define.cgi という設定ファイルを作成します。
     以下のように記述します（サンプルファイルも用意しています）。

  url=http://～/trade.cgi		← 希望サイトの trade.cgi のアドレス
  password=123456789abcdef		← こちらで適当にパスワードを設定

   ※最後に改行をつけるのを忘れがちです。
     改行で終わらせてください。

     そして，サーバーにフォルダごとアップします。
     パーミッションは，次の通りです。

              街コード <dir> [777]
                └ define.cgi   [644]

  # 設置したtrade-system.cgi のアドレスへアクセスし，
  # エラーが無ければ（何も表示されなければ）とりあえず大丈夫っぽいです。


３） 相手方に，設定した貿易パスワードを連絡します。
     相手がそのパスワードを組み込むことで，貿易接続が可能になります。

  # また，可能な限り，このスクリプトを設置しているサイトのグローバルIPアドレスを
  # 「貿易許可IP」として相手に連絡し，設定してもらってください。不正な貿易操作を防ぐことができます。

  ※ グローバルIPアドレスを知るにはサーバーに問い合わせてください。

